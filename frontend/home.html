<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Pagina Inicial</title>

   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
   <link rel="stylesheet" href="css/style.css">
</head>
<body>
   
<header class="header">
   <section class="flex">

      <div class="logo">
         <div id="menu-btn"></div>
         <a href="home.html">Reviews</a>
      </div>
   
      <div class="search-form">
         <form action="" class="search-bar">
            <input type="search" id="searchBox" class="box" placeholder="Buscar anime">
            <label for="searchBox" class="fas fa-search"></label>
         </form>
      </div>

      <a href="login.html" class="btn"><i class="fas fa-user"></i>Entrar</a>

      <div id="search-toggler" class="fas fa-search"></div>
   </section>
</header>

<div class="side-bar">
   <nav class="navbar">
      <div id="close-btn"><i class="fas fa-angle-left"></i>menu</div>
   </nav>
</div>
 
<div class="hero">
   <div class="hero-slider swiper">
      <div class="swiper-wrapper">
         <div class="slide swiper-slide" style="background:url('images/hero-1.jpg') center/cover no-repeat">
            <section class="content">
               <div>
                  <h3>One Piece</h3>
                  <p class="description">One Piece é uma série de mangá e anime que segue a história de Monkey D. Luffy, um jovem pirata com o sonho de se tornar o Rei dos Piratas. Para isso, ele reúne uma tripulação, os Piratas do Chapéu de Palha, e embarca em uma jornada épica pelo mundo em busca do lendário tesouro chamado One Piece, deixado pelo Rei dos Piratas Gold Roger. Ao longo do caminho, eles enfrentam diversos desafios, incluindo outros piratas, organizações criminosas e o Governo Mundial. </p>
                  <div class="buttons">
                     <a href="anime_details.html" class="btn">Comente agora</a>
                  </div>
               </div>
            </section>
         </div>
      </div>
   </div>
</div>

<section class="latest">

   <h1 class="heading">Animes mais conhecidos</h1>

   <div class="posts-container">

      <div class="post">
         <div class="image">
            <img src="images/img-7.jpg" alt="">        
         </div>
         <h3><a href="#">demon slayers</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-8.jpg" alt="">
         </div>
         <h3><a href="#">no longer allowed in another world</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-9.jpg" alt="">
         </div>
         <h3><a href="#">rising of shield hero</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-10.jpg" alt="">
         </div>
         <h3><a href="#">hunter x hunter</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-11.jpg" alt="">
         </div>
         <h3><a href="#">my hero academia</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-12.jpg" alt="">
         </div>
         <h3><a href="#">one punch man</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-13.jpg" alt="">
         </div>
         <h3><a href="#">blue lock</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-14.jpg" alt="">
         </div>
         <h3><a href="#">jujutsu kaisen</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-15.jpg" alt="">
         </div>
         <h3><a href="#">farming life in another world</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

      <div class="post">
         <div class="image">
            <img src="images/img-16.jpg" alt="">
         </div>
         <h3><a href="#">black clover</a></h3>
         <div class="info">
            <span><i class="fa-regular fa-comment"></i>0</span>
            <span><i class="fas fa-clock"></i>24m</span>
         </div>
      </div>

   </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', () => {
  function atualizarBotaoLogin() {
    const headerLoginBtn = document.querySelector('header .btn[href="login.html"]') || document.querySelector('header .btn');
    if (!headerLoginBtn) return;

    const token = localStorage.getItem('token');
    const userId = localStorage.getItem('userId');

    if (token && userId) {
      headerLoginBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Sair';
      headerLoginBtn.href = '#';
      headerLoginBtn.onclick = (e) => {
        e.preventDefault();
        localStorage.removeItem('token');
        localStorage.removeItem('userId');
        window.location.reload();
      };
    } else {
      headerLoginBtn.innerHTML = '<i class="fas fa-user"></i> Entrar';
      headerLoginBtn.href = 'login.html';
    }
  }
  atualizarBotaoLogin();
});
</script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const posts = document.querySelectorAll('.post');

  for (const post of posts) {
    const animeName = post.querySelector('h3 a').textContent.trim();
    const imageSrc = post.querySelector('img').getAttribute('src');
    const commentSpan = post.querySelector('.info span i.fa-comment').parentElement;
    try {
      const res = await fetch(`http://localhost:5000/api/reviews/${encodeURIComponent(animeName)}`);
      const data = await res.json();
      commentSpan.innerHTML = `<i class="fa-regular fa-comment"></i> ${Array.isArray(data) ? data.length : 0}`;
    } catch {
      commentSpan.innerHTML = `<i class="fa-regular fa-comment"></i> 0`;
    }
    post.addEventListener('click', () => {
      const params = new URLSearchParams({
        anime: animeName,
        img: imageSrc
      });
      window.location.href = `anime_details.html?${params.toString()}`;
    });
  }
});
</script>

    // Clique no card → abre o anime correspondente
    post.addEventListener('click', () => {
      window.location.href = `anime_details.html?anime=${encodeURIComponent(animeName)}`;
    });
  }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="js/script.js"></script>   
</body>
</html>
